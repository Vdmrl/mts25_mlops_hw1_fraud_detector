# ML Fraud Detection Service

## Архитектура решения
```
├── .gitignore
├── Dockerfile
├── docker-compose.yml
├── README.md
├── app/
│ └── app.py # Ядро сервиса с обработчиком файлов
├── models/
│ └── my_catboost.cbm # Сериализованная модель CatBoost
├── src/
│ ├── preprocessing.py # Пайплайн обработки данных
│ └── scorer.py # Модуль прогнозирования
└── train_data/
│ └── train.csv # Данные для обучения (reference), необходимо скачать из соревнования
└── input/ # Директория для загрузки файлов на скоринг
└── output/ # Директория с результатами скоринга
```

## Ключевые особенности

### Многоуровневое логирование
- Регистрация всех событий в файл `/app/logs/service.log`
- Консольный вывод для мониторинга в реальном времени
- 3 уровня детализации:
  - `INFO`: Основные этапы обработки
  - `DEBUG`: Детали преобразования данных
  - `ERROR`: Критические сбои с трейсбэками

### Пайплайн обработки данных (`preprocessing.py`)
1. **Временные признаки**:
   - Извлечение часа, дня недели, месяца
   - Удаление исходного timestamp
   
2. **Геопространственные расчеты**:
   - Расчет расстояния (км) между клиентом и мерчантом
   - Использование формулы гаверсинусов

3. **Категориальные переменные**:
   - Группировка редких категорий (N+1 кодирование)
   - Mean-encoding с учетом целевой переменной

4. **Числовые признаки**:
   - Импутация средними значениями
   - Логарифмирование с добавлением эпсилон-коррекции

### Модельный слой (`scorer.py`)
- Порог классификации: 0.98
- Автоматическая загрузка модели при инициализации
- Батчевая обработка через `predict_proba`

## Быстрый старт

### Требования
- Docker 20.10+
- 2 ГБ свободного места
- Порты: только файловая система

### Запуск сервиса

1.  **Клонируйте репозиторий** на ваш компьютер.
2.  **Запустите сервис** с помощью одной команды. Откройте терминал в корневой папке проекта и выполните:
    ```bash
    docker-compose up --build -d
    ```
Сервис запущен и готов к работе.

## Использование

1.  **Поместите CSV-файл** для скоринга (например, `input.csv`) в директорию `./input`.
2.  Сервис автоматически файл и начнет его обработку.
3.  **Результаты появятся** в директории `./output` в виде трех файлов:
    *   `sample_submission.csv` — итоговый файл с предсказаниями (0 или 1).
    *   `feature_importances.json` — JSON-файл с топ-5 самых важных признаков модели.
    *   `scores_distribution.png` — изображение с графиком распределения предсказанных вероятностей.

## Управление сервисом

-   **Просмотр логов в реальном времени:**
    ```bash
    docker-compose logs -f
    ```

-   **Остановка и удаление сервиса:**
    ```bash
    docker-compose down
    ```

## Соревнование

Ссылка на соревнование - https://www.kaggle.com/competitions/teta-ml-1-2025